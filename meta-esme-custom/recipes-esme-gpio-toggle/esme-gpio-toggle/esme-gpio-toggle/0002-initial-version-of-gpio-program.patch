From 2b46a91819caf0c360b78d4d5b36dc6cae69ed08 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Am=C3=A9lie?= <marieamelie20@icloud.com>
Date: Wed, 19 Nov 2025 08:43:24 +0100
Subject: [PATCH] initial version of gpio program

---
 Makefile           | 19 +++++++++++++++
 esme-gpio-toggle.c | 58 ++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 77 insertions(+)
 create mode 100644 Makefile
 create mode 100644 esme-gpio-toggle.c

diff --git a/Makefile b/Makefile
new file mode 100644
index 0000000..5d1555b
--- /dev/null
+++ b/Makefile
@@ -0,0 +1,19 @@
+# Dossier d'installation par défault 
+INSTALL_DIR ?= ./.install
+
+# Options de compilation générales (on ajoute, on ne remplace pas)
+CFLAGS += -Wall -Wextra -O2
+CFLAGS += $(shell pkg-config --cflags libgpiod )
+LDLIBS += $(shell pkg-config --libs libgpiod )
+
+# Construit le programme esme-gpio-toggle
+esme-gpio-toggle: esme-gpio-toggle.o
+
+# Cible d'installation
+install: esme-gpio-toggle
+	mkdir -p $(INSTALL_DIR)/usr/bin
+	cp esme-gpio-toggle $(INSTALL_DIR)/usr/bin/
+
+# Nettoyage des fichiers générés
+clean:
+	$(RM) esme-gpio-toggle *.o
diff --git a/esme-gpio-toggle.c b/esme-gpio-toggle.c
new file mode 100644
index 0000000..403a2e9
--- /dev/null
+++ b/esme-gpio-toggle.c
@@ -0,0 +1,58 @@
+#include <gpiod.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <unistd.h>     
+#include <string.h> 
+
+// GPIO par défaut si aucun argument n'est donné
+#define DEFAULT_GPIO 26
+
+// Le chip GPIO utilisé sur Raspberry Pi (toujours gpiochip0)
+#define GPIO_CHIP "/dev/gpiochip0"
+
+int main(int argc, char *argv[])
+{
+    int gpio_number = DEFAULT_GPIO;
+    int value = 0;   // Valeur envoyée à la LED (0 ou 1)
+
+    // Lire les arguments 
+    if (argc == 3 && strcmp(argv[1], "--gpio") == 0) {
+        gpio_number = atoi(argv[2]);   // Convertir en entier
+    }
+
+    printf("GPIO utilisée : %d\n", gpio_number);
+
+    // Ouvrir le chip GPIO
+    struct gpiod_chip *chip = gpiod_chip_open(GPIO_CHIP);
+    if (!chip) {
+        printf("Erreur : impossible d'ouvrir %s\n", GPIO_CHIP);
+        return 1;
+    }
+
+
+    // Récupérer la ligne passé dans le terminal
+    struct gpiod_line *line = gpiod_chip_get_line(chip, gpio_number);
+    if (!line) {
+        printf("Erreur : impossible d'accéder à la GPIO %d\n", gpio_number);
+        gpiod_chip_close(chip);
+        return 1;
+    }
+
+    // Demander la GPIO en sortie
+    if (gpiod_line_request_output(line, "esme-gpio-toggle", 0) < 0) {
+        printf("Erreur : impossible de configurer la GPIO en sortie.\n");
+        gpiod_line_release(line);
+        gpiod_chip_close(chip);
+        return 1;
+    }
+
+    // Faire clignoter la led toutes les secondes
+    while (1) {
+        value = !value;  // Inverser la valeur 
+        gpiod_line_set_value(line, value);
+        printf("GPIO %d = %d\n", gpio_number, value);
+        sleep(1); // Attendre une seconde
+    }
+    
+    return 0;
+}
